<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>
  <style>#map {position:absolute; top:0; bottom:0; right:0; left:0;}</style>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
  <!-- Leaflet.heat -->
  <script src="https://cdn.jsdelivr.net/gh/python-visualization/folium@master/folium/templates/leaflet_heat.min.js"></script>
</head>
<body>
  <div id="map"></div>

  <script>
    // ⬇️ COORDINATES (replace this array on each update) ⬇️
    let coords = [
      [35.11950, -111.73533],
      [34.92212, -111.85642],
      [35.01860, -111.94991],
      [35.02470, -111.92386],
      [35.03390, -111.90647],
      [34.90953, -111.74896],
      [34.92680, -111.86010],
      [35.01195, -111.73836],
      [34.97664, -111.76026],
      [34.97513, -111.75728],
      [34.89513, -111.74040],
      [34.90855, -111.74977],
      [34.91208, -111.74846],
      [34.91291, -111.73999],
      [34.91437, -111.74834],
      [34.90799, -111.83706],
      [34.90379, -111.85560],
      [34.91689, -111.85206],
      [34.91689, -111.85206],
      [34.92116, -111.85634],
      [34.92116, -111.85634],
      [34.92788, -111.86337],
      [34.86708, -112.06828],
      [34.75374, -112.00665],
      [34.75393, -112.00320],
      [34.78973, -112.00745],
      [34.97594, -111.76827],
      [34.87923, -111.80794],
      [34.90506, -111.7882],
      [34.90262, -111.79028],
      [34.90212, -111.78436],
      [34.90515, -111.789],
      [34.91015, -111.81796],
      [34.90509, -111.83163],
      [34.8720,  -111.9051],
      [34.75506, -112.00655],
      [34.75954, -112.0105],
      [34.76345, -112.01252],
      [34.7522,  -111.99943],
      [34.88205, -111.98747],
      [34.8871,  -111.79821],
      [34.87866, -111.80389],
      [34.88572, -111.78774],
      [34.87938, -111.79474],
      [34.88009, -111.79972],
      [34.87729, -111.79363],
      [35.03752, -111.93031],
      [35.02676, -111.94425],
      [34.92249, -111.85566],
      [34.91341, -111.84906],
      [34.91591, -111.85709],
      [34.92081, -111.8569],
      [34.9256,  -111.85777]
    ];
    // ⬆️ COORDINATES ⬆️

    const fallbackCenter = [34.96, -111.87];
    const MAX_FIT_ZOOM = 13; // cap max zoom after fitBounds

    // Base map
    const map = L.map("map", {
      center: coords.length ? coords[0] : fallbackCenter,
      zoom: 11,
      zoomControl: true,
      maxZoom: 18
    });

    const esriTopo = L.tileLayer(
      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
      { attribution: "Esri", maxZoom: 18 }
    ).addTo(map);

    // Layers
    const heatLayer = L.heatLayer([], { radius: 55, blur: 40, minOpacity: 0.4 });
    const gpsMarkers = L.layerGroup();
    const trailsLayer = L.layerGroup();

    const overlays = {
      "Heatmap": heatLayer,
      "GPS Markers": gpsMarkers,
      "Trails": trailsLayer
    };
    L.control.layers({ "Esri Topo": esriTopo }, overlays, { collapsed: false, position: "topright" }).addTo(map);

    heatLayer.addTo(map);
    gpsMarkers.addTo(map);

    function refreshPoints(points){
      gpsMarkers.clearLayers();
      heatLayer.setLatLngs([]);

      points.forEach(function(pt){
        L.circleMarker(pt, {
          color: "black",
          fillColor: "white",
          fillOpacity: 0.7,
          radius: 5,
          weight: 3
        })
        .bindPopup(pt[0].toFixed(5) + ", " + pt[1].toFixed(5)) // plain coordinates
        .addTo(gpsMarkers);
      });

      heatLayer.setLatLngs(points);

      if(points.length){
        const bounds = L.latLngBounds(points);
        map.fitBounds(bounds, { padding: [20, 20] });
        if (map.getZoom() > MAX_FIT_ZOOM) map.setZoom(MAX_FIT_ZOOM);
      } else {
        map.setView(fallbackCenter, 11);
      }
    }

    // Initial render
    refreshPoints(coords);
  </script>
</body>
</html>
